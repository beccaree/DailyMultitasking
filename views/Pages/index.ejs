<!doctype html>
<html lang="en">

<head>
    <% include ../partials/htmlhead %>
</head>

<body class="no-menu smart-style-1">
<div>

    <!-- HEADER -->
    <% include ../partials/header %>
    <!-- END HEADER -->

    <!-- Left panel : Navigation area -->
    <% include ../partials/leftpanel %>
    <!-- END NAVIGATION -->

    <!-- MAIN PANEL -->
    <div id="main" role="main">

        <!-- MAIN CONTENT -->
        <div id="content">

            <div class="row">
                <div class="col-xs-12 col-sm-7 col-md-7 col-lg-4">
                    <h1 class="page-title txt-color-blueDark"><i class="fa fa-desktop fa-fw "></i>
                        My Dashboard
                    </h1>
                </div>
            </div>

            <!-- row -->
            <div class="row">

                <div class="col-sm-6 col-md-6 col-lg-6">

                    <!-- new widget -->
                    <div class="jarviswidget jarviswidget-color-blueDark">

                        <!-- widget options:
                        usage: <div class="jarviswidget" id="wid-id-0" data-widget-editbutton="false">

                        data-widget-colorbutton="false"
                        data-widget-editbutton="false"
                        data-widget-togglebutton="false"
                        data-widget-deletebutton="false"
                        data-widget-fullscreenbutton="false"
                        data-widget-custombutton="false"
                        data-widget-collapsed="true"
                        data-widget-sortable="false"

                        -->
                        <header>
                            <h2> Calendar  </h2>
                            <div class="widget-toolbar">
                                <!-- add: non-hidden - to disable auto hide -->
                                <div class="btn-group">
                                    <a class="btn btn-default btn-xs" type="button" href="javascript:void(0);" id="td">Day</a>
                                    <a class="btn btn-xs btn-default" type="button" href="javascript:void(0);" id="ag">Week</a>
                                    <a class="btn btn-xs btn-default" type="button" href="javascript:void(0);" id="mt">Month</a>
                                </div>
                            </div>
                        </header>

                        <!-- widget div-->
                        <div>
                            <div class="widget-body no-padding">
                                <!-- content goes here -->
                                <div class="widget-body-toolbar">

                                    <div id="calendar-buttons">

                                        <div class="btn-group">
                                            <a href="javascript:void(0)" class="btn btn-default btn-xs" id="btn-prev"><i class="fa fa-chevron-left"></i></a>
                                            <a href="javascript:void(0)" class="btn btn-default btn-xs" id="btn-next"><i class="fa fa-chevron-right"></i></a>
                                        </div>
                                    </div>
                                </div>
                                <div id="calendar"></div>

                                <!-- end content -->
                            </div>

                        </div>
                        <!-- end widget div -->
                    </div>
                    <!-- end widget -->
                </div>

                <div class="col-sm-6 col-md-6 col-lg-6">

                    <!-- new widget -->
                    <div class="jarviswidget jarviswidget-color-blueDark" id="wid-id-4" data-widget-editbutton="false" data-widget-colorbutton="false">
                        <header>
                            <h2> Task List </h2>
                            <div class="btn-group pull-right">
                                <a id="btn_add_task" class="btn btn-default btn-circle"><i class="fa fa-plus"></i></a>
                            </div>

                        </header>

                        <!-- widget div-->
                        <div>
                            <div class="widget-body no-padding smart-form">
                                <!-- content goes here -->
                                <h5 class="todo-group-title"><i class="fa fa-exclamation"></i> Unsolved Tasks (<small class="num-of-tasks">5</small>)</h5>
                                <ul id="sortable2" class="todo">
                                    <li>
                                        <span class="handle"><label class="checkbox"><input type="checkbox" name="checkbox-inline"><i></i></label></span>
                                        <p>
                                            <a href="javascript:void(0);" class="font-s">Email Karen</a>
                                            <span class="date">Nov 22, 2013</span>
                                        </p>
                                    </li>
                                    <li>
                                        <span class="handle"><label class="checkbox"><input type="checkbox" name="checkbox-inline"><i></i></label></span>
                                        <p>
                                            <a href="javascript:void(0);" class="font-s">call Grandma</a>
                                            <span class="date">Nov 23, 2013</span>
                                        </p>
                                    </li>
                                    <li>
                                        <span class="handle"><label class="checkbox"><input type="checkbox" name="checkbox-inline"><i></i></label></span>
                                        <p>
                                            <a href="javascript:void(0);" class="font-s">Take out the trash</a>
                                            <span class="date">Nov 23, 2013</span>
                                        </p>
                                    </li>
                                    <li>
                                        <span class="handle"><label class="checkbox"><input type="checkbox" name="checkbox-inline"><i></i></label></span>
                                        <p>
                                            <a href="javascript:void(0);" class="font-s">Walk the dog</a>
                                            <span class="date">Nov 22, 2013</span>
                                        </p>
                                    </li>
                                    <li>
                                        <span class="handle"><label class="checkbox"><input type="checkbox" name="checkbox-inline"><i></i></label></span>
                                        <p>
                                            <a href="javascript:void(0);" class="font-s">Call the rat exterminator</a>
                                            <span class="date">Nov 22, 2013</span>
                                        </p>
                                    </li>
                                </ul>

                                <h5 class="todo-group-title"><i class="fa fa-check"></i> Completed Tasks (<small class="num-of-tasks">1</small>)</h5>
                                <ul id="sortable3" class="todo">
                                    <li class="complete">
                                        <span class="handle"><label class="checkbox"><input type="checkbox" name="checkbox-inline"><i></i></label></span>
                                        <p>
                                            <a href="javascript:void(0);" class="font-s">Bake cake</a>
                                            <span class="date">Nov 22, 2013</span>
                                        </p>
                                    </li>
                                </ul>

                                <!-- end content -->
                            </div>

                        </div>
                        <!-- end widget div -->
                    </div>
                    <!-- end widget -->

                </div>

            </div>
            <!-- end row -->

            <!-- row -->
            <div class="row">

                <div class="col-sm-6 col-md-6 col-lg-6">

                    <!-- Empty space right now -->

                </div>

                <div class="col-sm-6 col-md-6 col-lg-6">

                    <div class="well well-sm" id="event-container">
                        <form>
                            <fieldset>
                                <legend>
                                    Draggable Events
                                </legend>
                                <ul id='external-events' class="list-unstyled">
                                    <li>
                                        <span class="bg-color-darken txt-color-white" data-description="Currently busy" data-icon="fa-time">Office Meeting</span>
                                    </li>
                                    <li>
                                        <span class="bg-color-blue txt-color-white" data-description="No Description" data-icon="fa-pie">Lunch Break</span>
                                    </li>
                                    <li>
                                        <span class="bg-color-red txt-color-white" data-description="Urgent Tasks" data-icon="fa-alert">URGENT</span>
                                    </li>
                                </ul>
                                <div class="checkbox">
                                    <label>
                                        <input type="checkbox" id="drop-remove" class="checkbox style-0" checked="checked">
                                        <span>remove after drop</span> </label>

                                </div>
                            </fieldset>
                        </form>

                    </div>
                </div>

            </div>
            <!-- end row -->


            <div id="modal_add_task" title="Dialog Simple Title">

                    <!-- widget div-->
                    <div>

                        <div class="widget-body">
                            <!-- content goes here -->

                            <form id="add-event-form">
                                <fieldset>

                                    <!-- Event Type field-->
                                    <div class="form-group">
                                        <div class="row">
                                            <div class="col-sm-12">
                                                <label>Type:</label>
                                                <div class="btn-group btn-group-sm btn-group-justified" data-toggle="buttons">
                                                    <label class="btn btn-default active">
                                                        <p class=""><i class="fa fa-calendar text-muted"> </i> Event</p>
                                                        <input type="radio" name="iconselect" id="icon-1" value="fa-info" checked>
                                                    </label>
                                                    <label class="btn btn-default">
                                                        <p class=""><i class="fa fa-bookmark-o text-muted"> </i> Task</p>
                                                        <input type="radio" name="iconselect" id="icon-2" value="fa-warning">
                                                    </label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Title field-->
                                    <div class="form-group">
                                        <div class="row">
                                            <div class="col-sm-12">
                                                <label>Event Title</label>
                                                <input class="form-control"  id="title" name="title" maxlength="40" type="text" placeholder="Event Title">
                                                <p class="note">Maxlength is set to 40 characters</p>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Description field-->

                                    <div class="form-group">
                                        <div class="row">
                                            <div class="col-sm-12">
                                                <label>Event Description</label>
                                                <textarea class="form-control" placeholder="Please be brief" rows="3" maxlength="255" id="description"></textarea>
                                                <p class="note">Maxlength is set to 255 characters</p>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Task Priority field-->
                                    <div class="form-group">
                                        <div class="row">
                                            <div class="col-sm-12">
                                                <label>Select Task Priority</label>
                                                <div class="btn-group btn-group-justified btn-select-tick" data-toggle="buttons">
                                                    <label class="btn bg-color-red active">
                                                        <input type="radio" name="priority" id="option1" value="bg-color-darken txt-color-white" checked>
                                                        <i class="fa fa-check txt-color-white"></i>
                                                        <p class="txt-color-white">Very High</p>
                                                    </label>
                                                    <label class="btn bg-color-orange">
                                                        <input type="radio" name="priority" id="option2" value="bg-color-blue txt-color-white">
                                                        <i class="fa fa-check txt-color-white"></i>
                                                        <p class="txt-color-white">High</p>
                                                    </label>
                                                    <label class="btn bg-color-greenLight">
                                                        <input type="radio" name="priority" id="option3" value="bg-color-orange txt-color-white">
                                                        <i class="fa fa-check txt-color-white"></i>
                                                        <p class="txt-color-white">Medium</p>
                                                    </label>
                                                    <label class="btn bg-color-blueLight">
                                                        <input type="radio" name="priority" id="option4" value="bg-color-greenLight txt-color-white">
                                                        <i class="fa fa-check txt-color-white"></i>
                                                        <p class="txt-color-white">Low</p>
                                                    </label>
                                                    <label class="btn bg-color-darken">
                                                        <input type="radio" name="priority" id="option5" value="bg-color-blueLight txt-color-white">
                                                        <i class="fa fa-check txt-color-white"></i>
                                                        <p class="txt-color-white">Very Low</p>
                                                    </label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Date and time field-->
                                    <div class="form-group">
                                        <div class="row">
                                            <div class="col-sm-12">
                                                <label>Select a start and end date</label>
                                            </div>

                                            <div class="col-sm-6">
                                                <div class="form-group">
                                                    <div class="input-group">
                                                        <input class="form-control" id="from" type="text" placeholder="From">
                                                        <span class="input-group-addon"><i class="fa fa-calendar"></i></span>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="col-sm-6">

                                                <div class="form-group">
                                                    <div class="input-group">
                                                        <input class="form-control" id="to" type="text" placeholder="Select a date">
                                                        <span class="input-group-addon"><i class="fa fa-calendar"></i></span>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="col-sm-12">
                                                <label>Timepicker (default):</label>
                                                <div class="input-group">
                                                    <input class="form-control" id="timepicker" type="text" placeholder="Select time">
                                                    <span class="input-group-addon"><i class="fa fa-clock-o"></i></span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </fieldset>
                            </form>

                            <!-- end content -->
                        </div>

                    </div>
                    <!-- end widget div -->
            </div><!-- #dialog-message -->

        </div>
        <!-- END MAIN CONTENT -->

    </div>
    <!-- END MAIN PANEL -->
    
</div>


<!-- General JS includes-->
<% include ../Partials/generalJS.ejs %>
<!-- END NAVIGATION -->

<!-- the following are page-specific js -->
<!--================================================== -->

<!-- Time picker -->
<script src="js/plugin/bootstrap-timepicker/bootstrap-timepicker.min.js"></script>

<!-- PAGE RELATED PLUGIN(S) -->
<script src="js/plugin/moment/moment.min.js"></script>
<script src="js/plugin/fullcalendar/jquery.fullcalendar.min.js"></script>

<!-- Page setup -->
<script type="text/javascript">
    $(document).ready(function() {

        pageSetUp();

        "use strict";

        var date = new Date();
        var d = date.getDate();
        var m = date.getMonth();
        var y = date.getFullYear();

        var hdr = {
            left: 'title',
            center: 'month,agendaWeek,agendaDay',
            right: 'prev,today,next'
        };

        var initDrag = function (e) {
            // create an Event Object (http://arshaw.com/fullcalendar/docs/event_data/Event_Object/)
            // it doesn't need to have a start or end

            var eventObject = {
                title: $.trim(e.children().text()), // use the element's text as the event title
                description: $.trim(e.children('span').attr('data-description')),
                icon: $.trim(e.children('span').attr('data-icon')),
                className: $.trim(e.children('span').attr('class')) // use the element's children as the event class
            };
            // store the Event Object in the DOM element so we can get to it later
            e.data('eventObject', eventObject);

            // make the event draggable using jQuery UI
            e.draggable({
                zIndex: 999,
                revert: true, // will cause the event to go back to its
                revertDuration: 0 //  original position after the drag
            });
        };

        var addEvent = function (title, priority, description, icon) {
            title = title.length === 0 ? "Untitled Event" : title;
            description = description.length === 0 ? "No Description" : description;
            icon = icon.length === 0 ? " " : icon;
            priority = priority.length === 0 ? "label label-default" : priority;

            var html = $('<li><span class="' + priority + '" data-description="' + description + '" data-icon="' +
                icon + '">' + title + '</span></li>').prependTo('ul#external-events').hide().fadeIn();

            $("#event-container").effect("highlight", 800);

            initDrag(html);
        };

        /* initialize the external events
         -----------------------------------------------------------------*/

        $('#external-events > li').each(function () {
            initDrag($(this));
        });

        // Add event button
        $('#add-event').click(function () {
            var title = $('#title').val(),
                priority = $('input:radio[name=priority]:checked').val(),
                description = $('#description').val(),
                icon = $('input:radio[name=iconselect]:checked').val();

            addEvent(title, priority, description, icon);
        });

        /* initialize the calendar
         -----------------------------------------------------------------*/

        $('#calendar').fullCalendar({

            header: hdr,
            editable: true,
            droppable: true, // this allows things to be dropped onto the calendar !!!

            drop: function (date, allDay) { // this function is called when something is dropped

                // retrieve the dropped element's stored Event Object
                var originalEventObject = $(this).data('eventObject');

                // we need to copy it, so that multiple events don't have a reference to the same object
                var copiedEventObject = $.extend({}, originalEventObject);

                // assign it the date that was reported
                copiedEventObject.start = date;
                copiedEventObject.allDay = allDay;

                // render the event on the calendar
                // the last `true` argument determines if the event "sticks" (http://arshaw.com/fullcalendar/docs/event_rendering/renderEvent/)
                $('#calendar').fullCalendar('renderEvent', copiedEventObject, true);

                // is the "remove after drop" checkbox checked?
                if ($('#drop-remove').is(':checked')) {
                    // if so, remove the element from the "Draggable Events" list
                    $(this).remove();
                }

            },

            select: function (start, end, allDay) {
                var title = prompt('Event Title:');
                if (title) {
                    calendar.fullCalendar('renderEvent', {
                            title: title,
                            start: start,
                            end: end,
                            allDay: allDay
                        }, true // make the event "stick"
                    );
                }
                calendar.fullCalendar('unselect');
            },

            events: [{
                title: 'Call the rat Gay',
                start: new Date(y, m, 1),
                description: 'long description',
                className: ["event", "bg-color-greenLight"],
                icon: 'fa-check'
            }, {
                title: 'Email Karen about ...',
                start: new Date(y, m, d, 10, 30),
                allDay: false,
                className: ["event", "bg-color-red"]
            }, {
                title: 'Lunch',
                start: new Date(y, m, d, 12, 0),
                end: new Date(y, m, d, 14, 0),
                allDay: false,
                className: ["event", "bg-color-darken"]
            }, {
                title: 'Birthday Party',
                start: new Date(y, m, d + 1, 19, 0),
                end: new Date(y, m, d + 1, 22, 30),
                allDay: false,
                className: ["event", "bg-color-darken"]
            }, {
                title: 'Call Grandma',
                start: new Date(y, m, 28),
                end: new Date(y, m, 29),
                className: ["event", "bg-color-darken"]
            }],

            eventRender: function (event, element, icon) {
                if (!event.description == "") {
                    element.find('.fc-title').append("<br/><span class='ultra-light'>" + event.description +
                        "</span>");
                }
                if (!event.icon == "") {
                    element.find('.fc-title').append("<i class='air air-top-right fa " + event.icon +
                        " '></i>");
                }
            },

            windowResize: function (event, ui) {
                $('#calendar').fullCalendar('render');
            }
        });

        /* hide default buttons */
        $('.fc-right, .fc-center').hide();


        $('#calendar-buttons #btn-prev').click(function () {
            $('.fc-prev-button').click();
            return false;
        });

        $('#calendar-buttons #btn-next').click(function () {
            $('.fc-next-button').click();
            return false;
        });

        $('#calendar-buttons #btn-today').click(function () {
            $('.fc-today-button').click();
            return false;
        });

        $('#mt').click(function () {
            $('#calendar').fullCalendar('changeView', 'month');
        });

        $('#ag').click(function () {
            $('#calendar').fullCalendar('changeView', 'agendaWeek');
        });

        $('#td').click(function () {
            $('#calendar').fullCalendar('changeView', 'agendaDay');
        });

        $(".js-status-update a").click(function() {
            var selText = $(this).text();
            var $this = $(this);
            $this.parents('.btn-group').find('.dropdown-toggle').html(selText + ' <span class="caret"></span>');
            $this.parents('.dropdown-menu').find('li').removeClass('active');
            $this.parent().addClass('active');
        });

        /*
         * TODO: add a way to add more todo's to list
         */

        // initialize sortable
        $(function() {
            $("#sortable1, #sortable2").sortable({
                handle : '.handle',
                connectWith : ".todo",
                update : countTasks
            }).disableSelection();
        });

        // check and uncheck
        $('.todo .checkbox > input[type="checkbox"]').click(function() {
            var $this = $(this).parent().parent().parent();

            if ($(this).prop('checked')) {
                $this.addClass("complete");

                // remove this if you want to undo a check list once checked
                //$(this).attr("disabled", true);
                $(this).parent().hide();

                // once clicked - add class, copy to memory then remove and add to sortable3
                $this.slideUp(500, function() {
                    $this.clone().prependTo("#sortable3").effect("highlight", {}, 800);
                    $this.remove();
                    countTasks();
                });
            } else {
                // insert undo code here...
            }

        })
        // count tasks
        function countTasks() {

            $('.todo-group-title').each(function() {
                var $this = $(this);
                $this.find(".num-of-tasks").text($this.next().find("li").size());
            });

        }

        // Open the Add task modal
        $('#btn_add_task').click(function() {
            $('#modal_add_task').dialog('open');
            return false;
        });

        // Add task modal
        $("#modal_add_task").dialog({
            autoOpen : false,
            modal : true,
            width : 800,
            title : "Add New Task",
            buttons : [{
                html : "Cancel",
                "class" : "btn btn-default",
                click : function() {
                    $(this).dialog("close");
                }
            }, {
                html : "<i class='fa fa-check'></i>&nbsp; Create",
                "class" : "btn btn-primary",
                click : function() {

                    var title = $('#title').val(),
                        priority = $('input:radio[name=priority]:checked').val(),
                        description = $('#description').val(),
                        icon = $('input:radio[name=iconselect]:checked').val();

                    addEvent(title, priority, description, icon);

                    $(this).dialog("close");
                }
            }]

        });

        //Timepicker
        $('#timepicker').timepicker();



        // Date Range Picker
        $("#from").datepicker({
            defaultDate: "+1w",
            changeMonth: false,
            numberOfMonths: 1,
            prevText: '<i class="fa fa-chevron-left"></i>',
            nextText: '<i class="fa fa-chevron-right"></i>',
            onClose: function (selectedDate) {
                $("#to").datepicker("option", selectedDate);
            }

        });
        $("#to").datepicker({
            defaultDate: "+1w",
            changeMonth: false,
            numberOfMonths: 1,
            prevText: '<i class="fa fa-chevron-left"></i>',
            nextText: '<i class="fa fa-chevron-right"></i>',
            onClose: function (selectedDate) {
                $("#from").datepicker("option", selectedDate);
            }
        });
    })

</script>

</body>

